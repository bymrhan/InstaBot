'use strict';function f(a){return"undefined"===typeof a};function g(a,b){a.i.push(b);return a}function h(a,b){return g(a,()=>b)}function l(a){a.i.push(0);return a}function m(a){a.i.push(1);return a}function n(a){a.i.push(2);return a}function p(a){var b=a.i.shift();switch(typeof b){case "undefined":a.l&&a.l.call(null,a.g);break;case "function":a.g=b(a.g);p(a);break;case "number":switch(b){case 0:a.j.get(a.g,a.h);break;case 1:b=Object.keys(a.g);if(!b.every(d=>f(a.g[d]))){a.j.set(a.g,a.h);break}a.g=b;case 2:a.j.remove(a.g,a.h)}}}
function q(a,b,d){a.l=b;a.m=d;p(a)}async function t(a){return new Promise((b,d)=>{q(a,b,d)})}var u=class{constructor(a){this.j=a;this.i=[];this.h=this.h.bind(this)}h(a){var b;(b=chrome.runtime.lastError)?((this.m||console.error)(b),b=!0):b=!1;b||(this.g=a,p(this))}};var v=class{constructor(a){this.h=a;this.g=chrome.storage.sync}};function w(){return new Promise(a=>{let b=[];q(n(h(m(g(l(h(new u(chrome.storage.sync),null)),d=>{let c={};for(let e in d)e.startsWith("JSC.")&&(b.push(e),c["JS2."+e.slice(4)]=!1);return c})),b)),a)})};const x=chrome.storage.sync;async function y(a){return(await t(l(h(new u(x),{[a]:!0}))))[a]}async function z(){var a=await y("VER");f(a)||!/^\d+\.\d+\.\d+$/.test(a)?(a=await y("JS2."),f(a)?A("1.3.0"):A("2.0.0")):0>B(a,chrome.runtime.getManifest().version)&&A(a)}
async function A(a){function b(c){const e=new v(c),r={};for(let [k,D]of Object.entries(d[c]))(!a||0<B(k,a))&&Object.assign(r,D);c={};for(let k in r)c[e.h+k]=r[k];q(m(h(new u(e.g),c)),void 0)}const d=await (await fetch("/assets/default_exclusions.json")).json();b("JS2.");b("CSS.");a&&0>B(a,"2.0.0")&&await w();await t(m(h(new u(x),{["VER"]:chrome.runtime.getManifest().version})))}
function B(a,b){a=a.split(".").map(C);b=b.split(".").map(C);return a[0]>b[0]?1:a[0]<b[0]?-1:a[1]>b[1]?1:a[1]<b[1]?-1:a[2]>b[2]?1:a[2]<b[2]?-1:0}function C(a){return parseInt(a,10)};chrome.runtime.onMessage.addListener((a,b)=>{if(2===a.type)z();else{var d=b.tab?b.tab.id:a.data,c={file:"assets/user-select.css",cssOrigin:"user"};b.tab?c.frameId=b.frameId:c.allFrames=!0;switch(a.type){case 0:c.runAt="document_start";chrome.tabs.insertCSS(d,c);break;case 1:chrome.tabs.removeCSS(d,c)}}});chrome.runtime.onInstalled.addListener(async a=>{"install"!==a.reason&&"update"!==a.reason||await A(a.previousVersion)});
// Copyright 2021, Sean Lee <i73hi64d0wr5df8pckig@gmail.com>. All rights reserved.