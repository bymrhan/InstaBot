/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[15],{369:function(ha,ca,f){function aa(e,h,f){h.endsWith("/")||(h+="/");f=f||{};var r=f.disableWebsockets||!1;this.lU=f.singleServerMode||!1;null!=f.customQueryParameters&&Object(z.b)("wvsQueryParameters",f.customQueryParameters);h.endsWith("blackbox/")||(h+="blackbox/");this.mn=f.uploadData||null;this.yw=f.uriData||null;this.$M=f.cacheKey||null;this.yE=Object(n.a)(h,null,r);this.Wf=h;this.QE=e;this.wf=null;this.ii=x();this.gm=x();
this.Ey=!1;this.kg=this.Zd=this.pe=this.cf=null;this.Cf=[];this.mz=[];this.cache={};this.timeStamp=0;this.Sf=[];this.lh=[];this.lF=null;this.IE=!1;this.zI=this.id=null;this.fH=this.VP=fa;this.uB=0;this.nG=!1;this.H8=1;this.AA={};this.Pz=null;this.ks(!0)}function x(){var e={promise:null,resolve:null,reject:null,state:0,result:null,request:null,Yo:function(){return 1===(e.state&1)},E7:function(){return 2===(e.state&2)},bi:function(){return!e.E7()&&!e.Yo()},k7:function(){return 4===(e.state&4)},yT:function(){e.state|=
4}};e.promise=new Promise(function(h,f){e.resolve=function(){if(0===e.state||4===e.state)e.state=1,e.result=arguments[0],h.apply(null,arguments)};e.reject=function(){if(0===e.state||4===e.state)e.state=2,f.apply(null,arguments)}});return e}function fa(){return!1}function da(e,h,f){if(!(h in ea))return!0;h=ea[h];for(var n=0;n<h.length;n++){var r=e;var w=h[n];var x=f;if(w.name in r){var y="",z=!1;r=r[w.name];switch(w.type){case "s":y="String";z=Object(ba.isString)(r);break;case "a":y="Array";z=Object(ba.isArray)(r);
break;case "n":y="Number";z=Object(ba.isNumber)(r)&&Object(ba.isFinite)(r);break;case "o":y="Object",z=Object(ba.isObject)(r)&&!Object(ba.isArray)(r)}z||x.reject('Expected response field "'+w.name+'" to have type '+y);w=z}else x.reject('Response missing field "'+w.name+'"'),w=!1;if(!w)return!1}return!0}f.r(ca);var ba=f(0);f.n(ba);var y=f(1);ha=f(42);var r=f(31),n=f(387),h=f(79),e=f(312),w=f(125),z=f(39),ia=f(137),ea={pages:[{name:"pages",type:"a"}],pdf:[{name:"url",type:"s"}],docmod:[{name:"url",
type:"s"},{name:"rID",type:"s"}],health:[],tiles:[{name:"z",type:"n"},{name:"rID",type:"n"},{name:"tiles",type:"a"},{name:"size",type:"n"}],annots:[{name:"url",type:"s"},{name:"name",type:"s"}],image:[{name:"url",type:"s"},{name:"name",type:"s"},{name:"p",type:"n"}],text:[{name:"url",type:"s"},{name:"name",type:"s"},{name:"p",type:"n"}]};aa.prototype=Object(ba.extend)(aa.prototype,{l1:function(){var e=this;return new Promise(function(h,f){var n=new XMLHttpRequest;n.open("GET",e.Wf+"ck");n.withCredentials=
e.No();n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?h():f())};n.send()})},cca:function(e,h){this.VP=e||fa;this.fH=h||fa},pN:function(){var e=this;this.gm=x();this.ii=x();return this.yE.bF().then(function(){e.Ey=!1;e.id=null;e.IE=!1;return e.l1()})},nI:function(){this.VP();this.dA();this.cf&&(this.cf.bi()?this.xf(this.cf.request):this.cf.Yo()&&this.fH(this.cf.result.url,"pdf")&&(this.cf=null,this.ZS()));this.kg&&this.kg.bi()&&this.xf(this.kg.request);this.pe&&
this.pe.bi()?this.xf(this.pe.request):this.Zd&&this.Zd.bi()&&this.JP(this.Zd.request);var e;for(e=0;e<this.Sf.length;e++)this.Sf[e]&&this.Sf[e]&&(this.Sf[e].bi()?this.xf(this.Sf[e].request):this.Sf[e].Yo()&&this.fH(this.Sf[e].result.url,"image")&&(this.Sf[e]=null,this.sB(e)));for(e=0;e<this.lh.length;e++)this.lh[e]&&this.lh[e]&&this.lh[e].bi()&&!this.lh[e].k7()&&this.xf(this.lh[e].request);for(e=0;e<this.Cf.length;e++)this.Cf[e]&&this.Cf[e].bi()&&this.xf(this.Cf[e].request)},dA:function(e){var h=
this;this.Ey||(this.timeStamp=Date.now(),this.yE.hJ(function(e){h.W8(e)},function(){return null},function(){return null},!0).then(function(){clearInterval(h.jB);h.jB=null},function(f){h.Ey=!1;if(!h.jB){var n=0;h.IE=!0;h.zI=0;h.jB=setInterval(function(){2>n++?h.nI():(clearInterval(h.jB),e&&e.reject(w.a),Object(y.f)("WebViewerServer connection failed:"+f))},5E3)}}),this.Ey=!0)},lea:function(){var e=this,h=createPromiseCapability();if(this.mn){var f=new FormData;f.append("file",this.mn.fileHandle,this.mn.fileHandle.name);
var n=this.mn.loadCallback;var w="upload";var x=this.mn.extension}else if(this.yw){f={uri:this.yw.uri,$ha:this.yw.shareId};f=Object.keys(f).map(function(e){return e+"="+(f[e]?encodeURIComponent(f[e]):"")}).join("&");var y="application/x-www-form-urlencoded; charset=UTF-8";n=this.yw.loadCallback;w="url";x=this.yw.extension}else return Promise.resolve();var z=new XMLHttpRequest,aa=Object(r.i)(e.Wf,"AuxUpload");aa=Object(ia.a)(aa)+"&type="+w+"&ext="+x;z.open("POST",aa);z.withCredentials=this.No();y&&
z.setRequestHeader("Content-Type",y);z.addEventListener("load",function(){if(z.readyState===z.DONE&&200===z.status){var f=JSON.parse(z.response);e.QE=f.uri;n(f);h.resolve(f)}});z.addEventListener("error",function(){h.reject(z.statusText+" "+JSON.stringify(z))});this.mn&&null!=this.mn.onProgress&&(z.upload.onprogress=function(h){e.mn.onProgress(h)});z.send(f);return h.promise},uca:function(e){this.Pz=e},m6:function(e){this.password&&this.ii.Yo()?e(this.password):this.Pz(e)},Laa:function(e){this.password=
e||null;this.ii.Yo()||(this.dA(this.ii),this.xf({t:"pages"}));return this.ii.promise},Sv:function(e){this.lF=e||null;this.ii.Yo()||(this.dA(this.ii),this.xf({t:"pages"}));return this.ii.promise},rN:function(e){e=Object.assign(e,{uri:encodeURIComponent(this.QE)});this.lF&&(e.ext=this.lF);this.wf&&(e.c=this.wf);this.password&&(e.pswd=this.password);this.$M&&(e.cacheKey=this.$M);return e},xf:function(e){e=this.rN(e);this.yE.send(e)},tk:function(e){return e},W8:function(e){var f=this,n=e.data,r=e.err,
w=e.t;if(r&&f.Pz&&"This document could not be decrypted with the given password"===r)f.Pz(function(e){f.Laa(e)});else switch(w){case "upload":r?f.mea.reject(r):f.mea.resolve("Success");break;case "pages":r?f.ii.reject(r):da(n,w,f.ii)&&f.ii.resolve(n);break;case "config":r?f.gm.reject(r):da(n,w,f.gm)&&(n.id&&(f.id=n.id),n.auth&&(e=Object(z.a)("wvsQueryParameters"),e.auth=n.auth,Object(z.b)("wvsQueryParameters",e)),n.serverVersion&&(f.Iea=n.serverVersion,Object(y.g)("[WebViewer Server] server version: "+
f.Iea)),n.serverID?(f.uB=n.serverID===f.zI&&f.nG?f.uB+1:0,f.zI=n.serverID):f.uB=0,f.nG=!1,f.gm.resolve(n));break;case "health":r?f.gm.reject(r):da(n,w,f.gm)&&(n=n.unhealthy,f.lU&&n?Object(y.i)("Server failed health check. Single server mode ignoring check."):!f.vga&&n&&1>=f.uB&&(f.nG=!0,f.pN().then(function(){f.nI()},function(){f.nI()})));break;case "pdf":n.url=Object(ia.a)(f.Wf+"../"+encodeURI(n.url));r?f.cf.reject(r):da(n,w,f.cf)&&f.cf.resolve(n);break;case "docmod":n.url=Object(ia.a)(f.Wf+"../"+
encodeURI(n.url));r?f.AA[n.rID].reject(r):da(n,w,f.cf)&&f.AA[n.rID].resolve(n);break;case "xod":if(r)this.pe&&this.pe.bi()&&this.pe.reject(r),this.Zd&&this.Zd.bi()&&this.Zd.reject(r);else if(n.notFound)n.noCreate||this.pe&&this.pe.bi()&&this.pe.resolve(n),this.Zd&&this.Zd.bi()&&this.Zd.resolve(n);else{n.url&&(n.url=Object(ia.a)(f.Wf+"../"+encodeURI(n.url)));if(!this.Zd||this.Zd.Yo())this.Zd=x(),this.Zd.request={t:"xod",noCreate:!0};this.pe||(this.pe=x(),this.pe.request={t:"xod"});this.Zd.resolve(n);
this.pe.resolve(n)}break;case "annots":if(r)f.kg.reject(r);else if(da(n,w,f.kg)){f.kg.yT();var aa=new XMLHttpRequest;e=f.Wf+"../"+encodeURI(n.url);var ba=n.hasAppearance?Object(ia.a)(e+".xodapp"):null;aa.open("GET",Object(ia.a)(e));aa.responseType="text";aa.withCredentials=this.No();aa.addEventListener("load",function(){aa.readyState===aa.DONE&&200===aa.status&&f.kg.resolve({DJ:aa.response,KM:ba})});aa.addEventListener("error",function(){f.kg.reject(aa.statusText+" "+JSON.stringify(aa))});aa.send()}break;
case "image":var ca=this.Sf[n.p];r?ca.promise.reject(r):da(n,w,ca)&&(ca.result=n,ca.result.url=Object(ia.a)(f.Wf+"../"+encodeURI(ca.result.url)),ca.resolve(ca.result));break;case "tiles":ca=n.rID;e=this.Cf[ca];this.Cf[ca]=null;this.mz.push(ca);if(r)e.reject(r);else if(da(n,w,e)){for(r=0;r<n.tiles.length;r++)n.tiles[r]=Object(ia.a)(f.Wf+"../"+encodeURI(n.tiles[r]));e.resolve(n)}break;case "text":ca=this.lh[n.p];if(r)ca.reject(r);else if(da(n,w,ca)){ca.yT();var ea=new XMLHttpRequest;n=Object(ia.a)(f.Wf+
"../"+encodeURI(n.url));ea.open("GET",n);ea.withCredentials=this.No();ea.addEventListener("load",function(){ea.readyState===ea.DONE&&200===ea.status&&(ca.result=JSON.parse(ea.response),ca.resolve(ca.result))});ea.addEventListener("error",function(e){ca.reject(ea.statusText+" "+JSON.stringify(e))});ea.send()}break;case "progress":"loading"===n.t&&f.trigger(h.a.Events.DOCUMENT_LOADING_PROGRESS,[n.bytes,n.total])}},QO:function(){this.dA(this.gm);return this.gm.promise},j4:function(){this.kg||(this.kg=
x(),this.kg.request={t:"annots"},this.xf(this.kg.request));return this.kg.promise},sB:function(e){this.Sf[e]||(this.Sf[e]=x(),this.Sf[e].request={t:"image",p:e},this.xf(this.Sf[e].request));return this.Sf[e].promise},Maa:function(e){this.lh[e]||(this.lh[e]=x(),this.lh[e].request={t:"text",p:e},this.xf(this.lh[e].request));return this.lh[e].promise},Naa:function(e,h,f,n){var r=this.Cf.length;this.mz.length&&(r=this.mz.pop());this.Cf[r]=x();this.Cf[r].request={t:"tiles",p:e,z:h,r:f,size:n,rID:r};this.xf(this.Cf[r].request);
return this.Cf[r].promise},ZS:function(){this.cf||(this.cf=x(),this.cf.request={t:"pdf"},this.IE?this.cf.resolve({url:this.QE}):this.xf(this.cf.request));return this.cf.promise},gP:function(e){var h=this,f=new XMLHttpRequest,n=Object(ia.a)(this.Wf+"aul")+"&id="+this.id,r=new FormData,w={};e.annots&&(w.annots="xfdf");e.watermark&&(w.watermark="png");e.redactions&&(w.redactions="redact");w={t:"docmod",reqID:this.H8++,parts:w};e.print&&(w.print=!0);var y=this.rN(w);r.append("msg",JSON.stringify(y));
return Promise.all([e.annots,e.watermark,e.redactions].map(function(e){return Promise.resolve(e)})).then(function(e){var w=e[0],z=e[1],aa=e[2];w&&r.append("annots",w);z&&r.append("watermark",e.watermark);aa&&r.append("redactions",aa);h.AA[y.reqID]=x();f.open("POST",n);f.withCredentials=h.No;e=new Promise(function(e,h){f.onreadystatechange=function(){4===f.readyState&&(200===f.status?e():h("An error occurred while sending down annotation data to the server"))}});f.send(r);return e.then(function(){return h.AA[y.reqID].promise})})},
JP:function(){this.Zd||(this.Zd=x(),this.Zd.request={t:"xod",noCreate:!0},this.xf(this.Zd.request));return this.Zd.promise},Oaa:function(){this.pe||(this.pe=x(),this.pe.request={t:"xod"},this.xf(this.pe.request));return this.pe.promise},Xm:function(){return!0},request:function(){},uS:function(){},abort:function(){for(var e=0;e<this.Cf.length;e++)this.Cf[e]&&(this.Cf[e].resolve(null),this.Cf[e]=null,this.mz.push(e));this.close()},EB:function(e){this.wf=this.wf||{};this.wf.headers=e},Vga:function(){return this.wf?
Object(ba.omit)(this.wf.headers,["Cookie","cookie"]):null},ks:function(e){this.wf=this.wf||{};this.wf.internal=this.wf.internal||{};this.wf.internal.withCredentials=e},No:function(){return this.wf&&this.wf.internal?this.wf.internal.withCredentials:null},getFileData:function(){return Promise.reject()}});Object(ha.a)(aa);Object(e.a)(aa);Object(e.b)(aa);ca["default"]=aa},387:function(ha,ca,f){function aa(f,r,n){function h(e,h){function f(e){r().then(function(h){ca&&!ha?setTimeout(function(){f(e)},1):
h.send(JSON.stringify(e))})}function n(e,h,n,r){var ea=window.createPromiseCapability(),ia=!1,ja=ea;y=e;z=h;aa=n;x=null;r&&(e=Object(da.a)("wvsQueryParameters"),e.bcid=Object(fa.j)(8),Object(da.b)("wvsQueryParameters",e));try{e=Fa?sa+"/"+Fa:sa+"/ws";e=Object(ba.a)(e);var ka=new WebSocket(e);ka.onopen=function(){ea.resolve();ia=!0;ea=null;ca=!1;w.resolve(ka);z&&z()};ka.onerror=function(e){ca=ha=!0;ea&&ea.reject(e);x&&x.reject()};ka.onclose=function(){w=window.createPromiseCapability();ca=!0;x||(x=
window.createPromiseCapability());x.resolve();aa&&aa();y&&ia&&y({t:"health",data:{unhealthy:!0,isDead:!0}})};ka.onmessage=function(e){e&&e.data&&(e=JSON.parse(e.data),e.hb?f({hb:!0}):e.end?close():y(e))}}catch(Da){ea.reject(Da),ea=null}return ja.promise}function r(){ca&&y&&n(y);return w.promise}var w=window.createPromiseCapability(),x=null,y,z,aa=null,ca=!1,ha=!1,Fa=h,sa=function(e){var h=e.indexOf("://"),f="ws://";0>h?h=0:(5===h&&(f="wss://"),h+=3);var n=e.lastIndexOf("/");0>n&&(n=e.length);return f+
e.slice(h,n)}(e);return{send:f,hJ:n,bF:function(){return x?x.promise:r().then(function(e){x=window.createPromiseCapability();y=null;e.close();return x.promise})}}}function e(e){var h=e.lastIndexOf("/");0>h&&(h=e.length);return e.slice(0,h)}return window.WebSocket&&!n?h(f,r):function(h,f){function n(e){(ca?ca.promise:Promise.resolve(da)).then(function(h){var f=new XMLHttpRequest,n=aa?z+"/"+aa+"pf":z+"/pf";n=Object(ba.a)(n)+"&id="+h;h=new FormData;h.append("data",JSON.stringify(e));f.open("POST",n);
f.withCredentials=!0;f.send(h)})}function r(){da=0;ca||(ca=window.createPromiseCapability())}function w(){y=new XMLHttpRequest;var e=z+"/pf";e+=0!==da?"?id="+da+"&uc="+sa:"?uc="+sa;sa++;y.open("GET",e,!0);y.withCredentials=!0;y.setRequestHeader("Cache-Control","no-cache");y.setRequestHeader("X-Requested-With","XMLHttpRequest");var h=y,f=!1;y.onreadystatechange=function(){a:if(3<=h.readyState&&!f){try{var e=h.responseText.length}catch(Ba){Object(x.g)("caught exception");break a}if(0<e)try{var y=h.responseText.split("\n");
for(y[y.length-1]&&y.pop();0<y.length&&3>y[y.length-1].length;)"]"===y.pop()&&r();0<y.length&&3>y[0].length&&y.shift();for(e=0;e<y.length;++e)y[e].endsWith(",")&&(y[e]=y[e].substr(0,y[e].length-1));0===da&&0<y.length&&(da=JSON.parse(y.shift()).id,e=ca,ca=null,e.resolve(da));var z;for(e=0;e<y.length;++e)(z=JSON.parse(y[e]))&&z.end?close():z&&z.hb&&z.id===da?n({hb:!0}):Fa(z)}catch(Ba){}fa||(f=!0,w())}};y.send()}var y,z=e(h),aa=f,da=0,ca=window.createPromiseCapability(),fa=!1,ha=null,Fa=null,sa=0;return{send:n,
hJ:function(e,h,f){Fa=e;ha=f;fa=!1;r();w();h&&h();return Promise.resolve()},bF:function(){r();Fa=null;fa=!0;ha&&ha();y.abort();return Promise.resolve()}}}(f,r)}f.d(ca,"a",function(){return aa});var x=f(1),fa=f(31),da=f(39),ba=f(137)}}]);}).call(this || window)
